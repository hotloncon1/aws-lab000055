<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=https://hotloncon1.github.io/aws-lab000055/images/favicon.png type=image/png><title>Create And Expose the API with Amazon API Gateway :: Creating an Authenticated Single Page Application (SPA)</title><link href=https://hotloncon1.github.io/aws-lab000055/css/nucleus.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/fontawesome-all.min.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/hybrid.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/featherlight.min.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/perfect-scrollbar.min.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/auto-complete.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/atom-one-dark-reasonable.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/theme.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/hugo-theme.css?1659035587 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/theme-workshop.css?1659035587 rel=stylesheet><script src=https://hotloncon1.github.io/aws-lab000055/js/jquery-3.3.1.min.js?1659035587></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.3-create-api-with-api-gateway/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://hotloncon1.github.io/aws-lab000055/><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/lunr.min.js?1659035587></script>
<script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/auto-complete.js?1659035587></script>
<script type=text/javascript>var baseurl="https://hotloncon1.github.io/aws-lab000055/"</script><script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/search.js?1659035587></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-introduction/ title=Introduction class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/1-introduction/><b>1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prepare/ title=Preparation class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/2-prepare/><b>2. </b>Preparation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/2-prepare/2.1-createkeypair/ title="Create Key Pair" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/2-prepare/2.1-createkeypair/><b>2.1. </b>Create Key Pair
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prepare/2.2-createstack/ title="Create a CloudFormation stack" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/2-prepare/2.2-createstack/><b>2.2. </b>Create a CloudFormation stack
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prepare/2.3-connectvirtualmachine/ title="Connect to the Windows Instance" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/2-prepare/2.3-connectvirtualmachine/><b>2.3. </b>Connect to the Windows Instance
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/3-create-single-page-app/ title="Creating A Single Page Application" class="dd-item
parent"><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/><b>3. </b>Creating A Single Page Application
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-create-single-page-app/3.1-create-dynamodb-table/ title="Create A DynamoDB Table" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.1-create-dynamodb-table/><b>3.1. </b>Create A DynamoDB Table
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/ title="Manually Build And Deploy A Serverless Microservice" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/><b>3.2. </b>Manually Build And Deploy A Serverless Microservice
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-create-single-page-app/3.3-create-api-with-api-gateway/ title="Create And Expose the API with Amazon API Gateway" class="dd-item
active"><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.3-create-api-with-api-gateway/><b>3.3. </b>Create And Expose the API with Amazon API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-create-single-page-app/3.4-deploy-api-with-codestar/ title="Deploy the api using code star and CI/CD" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.4-deploy-api-with-codestar/><b>3.4. </b>Deploy the api using code star and CI/CD
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-create-single-page-app/3.5-setup-single-page-app-website/ title="Setup The Single Page Application Website" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.5-setup-single-page-app-website/><b>3.5. </b>Setup The Single Page Application Website
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-create-single-page-app/3.6-build-api-consumer/ title="Build A Client To Consume The API" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.6-build-api-consumer/><b>3.6. </b>Build A Client To Consume The API
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-configure-aaa/ title="Configure Authentication, Authorization and Accounting (AAA)" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/4-configure-aaa/><b>4. </b>Configure Authentication, Authorization and Accounting (AAA)
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-configure-aaa/4.1-add-authentication-with-cognito/ title="Add Authentication to the SPA using Amazon Cognito User Pools" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/4-configure-aaa/4.1-add-authentication-with-cognito/><b>4.1. </b>Add Authentication to the SPA using Amazon Cognito User Pools
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-configure-aaa/4.2-setup-authentication/ title="Microservice Authentication" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/4-configure-aaa/4.2-setup-authentication/><b>4.2. </b>Microservice Authentication
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-configure-aaa/4.3-deploy-and-test/ title="Deploy And Test" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/4-configure-aaa/4.3-deploy-and-test/><b>4.3. </b>Deploy And Test
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-configure-aaa/4.4-add-new-user-signup_signin/ title="Add New User Sign Up and Sign In" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/4-configure-aaa/4.4-add-new-user-signup_signin/><b>4.4. </b>Add New User Sign Up and Sign In
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-tracing-application-performance-with-xray/ title="Tracing Application Performance With AWS X-Ray" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/5-tracing-application-performance-with-xray/><b>5. </b>Tracing Application Performance With AWS X-Ray
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/6-challenge/ title=Challenge class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/6-challenge/><b>6. </b>Challenge
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-cleanup/ title="Clean up resources" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/7-cleanup/><b>7. </b>Clean up resources
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/660548818043427/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.3-create-api-with-api-gateway/ selected>English</option><option id=vi value=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.3-create-api-with-api-gateway/>Tiếng Việt</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7833031&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0></left>
<left><br><br><b>Last Updated</b><br><i><font color=orange>29-07-2022</font></i></left>
<left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a></i></left>
<script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://hotloncon1.github.io/aws-lab000055/>Refactor Your Data & Workflows</a> > <a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/>Creating A Single Page Application</a> > Create And Expose the API with Amazon API Gateway</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Create And Expose the API with Amazon API Gateway</h1><h4 id=create-and-expose-the-api-with-amazon-api-gateway>Create And Expose the API with Amazon API Gateway</h4><ol><li>Go to <a href=https://console.aws.amazon.com/apigateway/home><strong>AWS API Gateway console</strong></a>.</li></ol><ul><li>In the <strong>Choose an API type</strong> section, find <strong>REST API - Develop a REST API where you gain complete control over the request and response along with API management capabilities.</strong></li><li>Click <strong>Build</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-001.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=2><li>Click <strong>OK</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-002.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>In the <strong>Create new API</strong> section, select <strong>New API</strong></li></ol><ul><li>In the <strong>API name</strong> section, type <code>iDevelop - Trip Search API</code></li><li>In the <strong>Description</strong> section, type <code>Allows searching ở trips from/to cities</code></li><li>Click <strong>Create API</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-003.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=4><li>The API will be created, and have a <strong>root</strong> path element and nothing else.</li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-004.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=5><li>In the <strong>New Child Resource</strong> page</li></ol><ul><li>In the <strong>Resource Path</strong> section, type <code>trips</code></li><li>Check <strong>Enable API Gateway CORS</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-005.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=6><li>The <strong>/trips</strong> resource will be created. Click on the <strong>/trips</strong> link</li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Method</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-006.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=7><li>In the dropdown list that appears, select <strong>GET</strong></li></ol><ul><li>Click the grey tick next to the dropdown list to commit the change.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-007.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=8><li>In the <strong>Lambda Region</strong> section, select your <strong>Region</strong></li></ol><ul><li>In the <strong>Lambda Function</strong> section, type <code>idevelop</code> and select <strong>idevelopTripSearchFull</strong></li><li>Click <strong>Save</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-008.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=9><li>Click <strong>OK</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-009.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When the method is created, you will see the <strong>Method Execution</strong> panel:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-010.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-011.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-012.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>After a moment or two for the Lambda function to initialise and execute, you should see an output similar to this:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-013.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>/trips</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Enable CORS</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-014.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=15><li>Click <strong>Enable CORS and replace existing CORS headers</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-015.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Yes, replace existing values</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-016.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When each of the listed items have a green tick against them, you can move on to the next section. This will only take a moment.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-017.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ol><h4 id=expose-the-tripsfromcity-restful-api-endpoint>Expose the <strong>/tripsfromcity</strong> RESTful API endpoint</h4><p>The first path we exposed was quite simple - <strong>/trips</strong> gets all the trips in the system. But we know our source code implementation allows us to specify a filter to query for trips that originate from a particular city or have a particular destination, so we want to expose this functionality to our API consumers. First, we will expose the <strong>/tripsfromcity</strong> path.</p><ol start=18><li>In the <strong>Resources</strong> section, click <strong>/</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-018.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=19><li>In the <strong>Resource Name</strong> section, type <code>tripsfromcity</code></li></ol><ul><li>Select <strong>Enable API Gateway CORS</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-019.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=20><li>Our call into the Lambda function requires a city parameter. We will follow the standard pattern for RESTful interfaces, and pass this parameter in as a URL parameter. Select <strong>/tripsfromcity</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-020.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=21><li>In the <strong>Resource Name</strong> section, type <code>{city}</code></li></ol><ul><li>In the <strong>Resource Path</strong> section, delete the default and replace with <code>{city}</code></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-021.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=22><li>Click <strong>/{city}</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Method</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-022.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=23><li>In the dropdown list that appears, select <strong>GET</strong></li></ol><ul><li>Click the grey tick next to the dropdown list to commit the change.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-023.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=24><li>In the <strong>Lambda Region</strong> section, select your <strong>Region</strong></li></ol><ul><li>In the <strong>Lambda Function</strong> section, type <code>idevelop</code> and select <strong>idevelopTripSearchFromCity</strong></li><li>Click <strong>Save</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-024.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=25><li>Click <strong>OK</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-025.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When the method is created, you will see the <strong>Method Execution</strong> panel. as before for the /trips resource. We can’t go ahead and test the API call just yet, because we need to transform the request through API Gateway so that the city parameter is passed through to the Lambda function correctly.</li></ol><p>The <strong>devlounge.lambda.FindTripsFromCityHandler</strong> handler expects to see the input data in this JSON format:</p><pre tabindex=0><code>{
	&#34;payload&#34; : 
	{
        &#34;city&#34;: &#34;Melbourne&#34;
    }
}
</code></pre><div class="notices note"><p>This would cause the Lambda function to search DynamoDB for all trips that originate from Melbourne. We need to add a <strong>Body Mapping Template</strong> for this method in API Gateway to correctly transform the request into this format.</p></div><ul><li>Click <strong>Integration Request</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-026.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=27><li>Click <strong>Mapping Templates</strong></li></ol><ul><li>Click <strong>When there are no templates defined (recommended)</strong></li><li>Click <strong>Add mapping template</strong></li><li>In the <strong>Content-Type</strong> section , type <code>application/json</code></li><li>Click the grey tick icon to commit the change.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-027.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=28><li>Scroll further down to show the mapping template entry text field. Paste in the following template:</li></ol><pre tabindex=0><code>{
    &#34;payload&#34; : {
        &#34;city&#34;: &#34;$input.params(&#39;city&#39;)&#34;
    }
}
</code></pre><div class="notices info"><p>This template will take the parameter <strong>{city}</strong> from the URL and add it into a JSON payload that is sent to the Lambda function, as a property of the payload object, just as the Lambda function expects.</p></div><ul><li>Click <strong>Save</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-028.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><div class="notices note"><p>The schema defined here for this Lambda function is completely arbitrary, and in your own application you could use a completely different model. The mapping template gives you the flexibility to transform the inbound data on-the-fly through the API Gateway endpoint.</p></div><ol start=29><li>Click <strong>Method Execution</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-029.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-030.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>In the <strong>Path</strong> section, in <strong>{city}</strong> field, type <code>Melbourne</code></li></ol><ul><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-031.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=32><li>API Gateway will make the call into the Lambda function, passing the value Melbourne into the Body Mapping Template you have defined, which will insert the search parameter Melbourne into the JSON payload that is sent to the Lambda function. This will cause the function handler to consume the JSON and execute a search in the DynamoDB table, and return the results. You will see a result similar to this:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-032.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Select <strong>/{city}</strong> in <strong>/tripsfromcity</strong> section</li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Enable CORS</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-033.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=34><li>Click <strong>Enable CORS and replace existing CORS headers</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-034.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Yes, replace existing values</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-035.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When each of the listed items have a green tick against them, you can move on to the next section. This will only take a moment.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-036.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>/</strong> in <strong>Resources</strong> section</li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-037.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=38><li>In the <strong>Resource Name</strong> section, type <code>tripstocity</code></li></ol><ul><li>Select <strong>Enable API Gateway CORS</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-038.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=39><li>Our call into the Lambda function requires a <strong>city</strong> parameter. We will follow the standard pattern for RESTful interfaces, and pass this parameter in as a URL parameter. Click <strong>/tripstocity</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-039.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=40><li>In the <strong>Resource Name</strong> section, type <code>{city}</code></li></ol><ul><li>In the <strong>Resource Path</strong> section, delete the default and replace with <code>{city}</code></li><li>Select <strong>Enable API Gateway CORS</strong></li><li>Click <strong>Create Resource</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-040.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=41><li>Click <strong>/{city}</strong> in the section <strong>/tripstocity</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Create Method</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-041.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=42><li>In the dropdown list that appears, select <strong>GET</strong></li></ol><ul><li>Click the grey tick next to the dropdown list to commit the change.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-042.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=43><li>In the <strong>Lambda Region</strong> section, select your <strong>Region</strong></li></ol><ul><li>In the <strong>Lambda Function</strong> section, type <code>idevelop</code> and select <strong>idevelopTripSearchToCity</strong></li><li>Click <strong>Save</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-043.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=44><li>Click <strong>OK</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-044.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When the method is created, you will see the <strong>Method Execution</strong> panel, as before for the /tripsfromcity resource. We again need to transform the request through API Gateway so that the city parameter is passed through to the Lambda function correctly, before we can test this API call.</li></ol><p>The <strong>devlounge.lambda.FindTripsToCityHandler</strong> handler expects to see the input data in this JSON format:</p><pre tabindex=0><code>{
	&#34;payload&#34; : 
	{
        &#34;city&#34;: &#34;Melbourne&#34;
    }
}
</code></pre><div class="notices note"><p>This would cause the Lambda function to search DynamoDB for all trips that have Melbourne as a destination. We need to add a <strong>Mapping Template</strong> for this method in API Gateway to correctly transform the request into this format.</p></div><ul><li>Click <strong>Integration Request</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-045.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=46><li>Click <strong>Mapping Templates</strong></li></ol><ul><li>Select <strong>When there are no templates defined (recommended)</strong></li><li>Click <strong>Add mapping template</strong></li><li>In the <strong>Content-Type</strong> section, type <code>application/json</code></li><li>Click the grey tick to commit the change
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-046.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=47><li>Scroll further down to show the mapping template entry text field. Paste in the following template:</li></ol><pre tabindex=0><code>{
    &#34;payload&#34; : {
        &#34;city&#34;: &#34;$input.params(&#39;city&#39;)&#34;
    }
}
</code></pre><ul><li>Click <strong>Save</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-047.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=49><li>Click <strong>Method Execution</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-048.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-049.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>In the <strong>Path</strong> section, in the <strong>{city}</strong> field, type <code>Melbourne</code></li></ol><ul><li>Click <strong>Test</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-050.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=52><li>API Gateway will make the call into the Lambda function, passing the value Melbourne into the Body Mapping Template you have defined, which will insert the search parameter Melbourne into the JSON payload that is sent to the Lambda function. This will cause the function handler to consume the JSON and execute a search in the DynamoDB table, and return the results. You will see a result similar to this:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-051.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>/{city}</strong> in <strong>/tripstocity</strong> section</li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Enable CORS</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-052.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=54><li>Click <strong>Enable CORS and replace existing CORS headers</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-053.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Click <strong>Yes, replace existing values</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-054.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>When each of the listed items have a green tick against them, you can move on to the next section. This will only take a moment.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-055.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>If you have completed the steps above as described, you will have a resources tree that looks like this:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-056.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ol><h4 id=deploy-the-api-and-test>Deploy the API and test</h4><ol start=58><li>Now that you have confirmed that the microservices are functioning correctly, you are ready to deploy the API and test it from the publicly available endpoint. In the <strong>Resources</strong> section, click <strong>/</strong></li></ol><ul><li>Click <strong>Actions</strong></li><li>Click <strong>Deploy API</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-057.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=59><li>In the <strong>Deployment stage</strong> section, select <strong>[New Stage]</strong> to create a new deployment stage.</li></ol><ul><li>In the <strong>Stage name</strong> section, type <code>prod</code></li><li>In the <strong>Stage description</strong> section, type <code>Trips API</code></li><li>In the <strong>Deployment description</strong> section, type <code>Initial deployment</code></li><li>Click <strong>Deploy</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-058.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=60><li>The new stage <strong>prod</strong> will be created and you will see the <strong>prod Stage Editor</strong></li></ol><ul><li>Click <strong>Invoke URL</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-059.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=61><li>A new window will open and hit the stage endpoint. You will see an error message stating <strong>{&ldquo;message&rdquo;:&ldquo;Missing Authentication Token&rdquo;}</strong>. This is because there is no handler for the root of the stage - you have only defined resources/methods beneath the <strong>/trips</strong>, <strong>/tripsfromcity</strong> and <strong>/tripstocity</strong>paths.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-060.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Edit the URL in the URL bar of the browser and append <strong>/trips</strong> then press <strong>Enter</strong>. The page will refresh, and then display all of the available trips as JSON. The output will be similar to this:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-061.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Test the <strong>/tripsfromcity</strong> method, use <code>/tripsfromcity/Melbourne</code> to search for all trips that leave from Melbourne.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-062.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Test the <strong>/tripstocity</strong> method, use <code>/tripstocity/Melbourne</code> to search for all trips that go to Melbourne.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-063.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ol><p>NIf the data looks right, and there are no errors, you are ready to move on to the next exercise.</p><h4 id=use-cloudformationsam-via-the-aws-cli-to-deploy-the-hotelsearch-microservice>Use CloudFormation/SAM via the AWS CLI to deploy the HotelSearch microservice</h4><p>In the previous steps, you manually deployed and configured the <strong>TripSearch</strong> microservice, including the Lambda functions and API Gateway resources. You will have noticed that there are quite a few steps required, and doing this manually is time consuming and prone to errors. In this step, you will use the AWS CLI and CloudFormation/SAM to deploy the <strong>HotelSearch</strong> microservice, instead of manually deploying the resources.</p><p>By using CloudFormation/SAM, many of the manual steps will be taken care of for you, streamlining the deployment process. You will still have to manually trigger the process, but the actual deployment will be automated.</p><p>The <strong>HotelSpecials</strong> microservice needs to access a MySQL database to retrieve the hotel specials data. The lab environment has automatically deployed and seeded a database for you, and the connection details are provided in Cloudformation Outputs tab with instructions below on where to update the placeholder in the template you will use to deploy the microservice. The MySQL instance has been deployed using Amazon RDS and is not publicly-accessible since it is launched in a private subnet. Therefore, for the Lambda function to be able to connect to the database, the Lambda function will also need to be deployed into a private subnet by enabling VPC Integration. The template.yml file provided has all the required setup to do this, you just need to update the placeholders as per the below instructions.</p><section class="attachments orange"><label><i class="fas fa-paperclip" aria-hidden=true></i>
HotelSpecials Project</label><div class=attachments-files><li><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.3-create-api-with-api-gateway/_index.files/HotelSpecials.zip>HotelSpecials.zip</a>
(10 KB)</li><div></section><ol start=65><li>Download the <strong>HotelSpecials.zip</strong> file and extract</li><li>Open <strong>Command Prompt</strong> and navigate to the directory of the <strong>HotelSpecials</strong> project was extracted in step 65</li></ol><ul><li>Execute the following command:</li></ul><pre tabindex=0><code>set AWS_PROFILE=devaxacademy
mvn package shade:shade
</code></pre><p><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-064.png?featherlight=false&width=60pc" alt="Create And Expose the API with Amazon API Gateway">
67. When the target JAR is built, whick is in the <strong>target</strong> folder of the project and whose name is <strong>hotelspecials-1.0.0.jar</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-065.png?featherlight=false&width=60pc" alt="Create And Expose the API with Amazon API Gateway">
68. Go to <a href=https://console.aws.amazon.com/cloudformation/>AWS CloudFormation Console</a>.</p><ul><li>Click <strong>Stack</strong>.</li><li>Type <code>DevAx-06</code> to the search bar and press <strong>Enter</strong>.</li><li>Click <strong>DevAx-06</strong>.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-066.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=69><li>Click tab <strong>Output</strong></li></ol><ul><li>Save the value of <strong>DatabaseSecurityGroup</strong>, <strong>DatabaseSubnet1</strong>, <strong>DatabaseSubnet2</strong>, <strong>RDSEndpoint</strong> and <strong>S3BucketLambdaCodeBucketName</strong> to use in the next step.
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-067.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=70><li>In the Eclipse IDE, open the <strong>template.yml</strong> file
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-068.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li><li>Replace <strong>&lt;DatabaseSecurityGroup></strong> by the <strong>DatabaseSecurityGroup</strong> value we saved in step 69</li></ol><ul><li>Replace <strong>&lt;DatabaseSubnet1></strong> by the <strong>DatabaseSubnet1</strong> value we saved in step 69</li><li>Replace <strong>&lt;DatabaseSubnet2></strong> by the <strong>DatabaseSubnet2</strong> value we saved in step 69</li><li>Replace <strong>&lt;RDSEndpoint></strong> by the <strong>RDSEndpoint</strong> value we saved in step 69
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-069.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=72><li>In the <strong>Command Prompt</strong>, execute the following command to package the Lambda function</li></ol><pre tabindex=0><code>aws cloudformation package --template template.yml --s3-bucket &lt;S3BucketLambdaCodeBucketName&gt; --output-template template-export.yml
</code></pre><p><div class="notices note"><p>Replace <strong>&lt;S3BucketLambdaCodeBucketName></strong> by the <strong>S3BucketLambdaCodeBucketName</strong> value we saved in step 69</p></div><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-070.png?featherlight=false&width=60pc" alt="Create And Expose the API with Amazon API Gateway"><div class="notices info"><p>The command will upload the build artefact to the S3 bucket, and then update the <strong>template.yml</strong> pointer to the code artefact on S3, and write out a new template with this update included, to a file called <strong>template-export.yml</strong><br>It will take a moment or two for the upload of the artefact to complete.</p></div>73. Execute the following command to create and deploy a <strong>CloudFormation Change Set</strong></p><pre tabindex=0><code>aws cloudformation deploy --template-file template-export.yml --stack-name HotelSpecialsAPI --capabilities CAPABILITY_IAM
</code></pre><p><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-071.png?featherlight=false&width=60pc" alt="Create And Expose the API with Amazon API Gateway">
74. Go to <a href=https://console.aws.amazon.com/cloudformation/>AWS CloudFormation Console</a>.</p><ul><li>Click <strong>Stack</strong>.</li><li>You will see the <strong>HotelSpecialsAPI</strong> stack. This indicates that the CloudFormation Change Set has been created. The command you issued will create the Change Set and then automatically execute the Change Set. It will take a few moments to complete the execution
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-072.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=75><li>Select <strong>HotelSpecialsAPI</strong> stack, click tab <strong>Events</strong> and eview the steps that the CloudFormation template has applied to your environment. These will match the resources and actions in the <strong>template-output.yml</strong> file.</li><li>Go to <a href=https://console.aws.amazon.com/apigateway/home><strong>AWS API Gateway console</strong></a></li></ol><ul><li>Click <strong>iDevelop - Hotel Specials API</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-073.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=77><li>Click <strong>Get</strong></li></ol><ul><li>Click <strong>Integration Request</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-074.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=78><li>The <strong>Integration Request</strong> panel will be shown. <strong>Lambda Function</strong> specified:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-075.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ol><p>The specified value is not a Lambda function, but instead, is a <strong>Stage Variable</strong> that will be replaced at runtime by API Gateway. Therefore, in order for this API call to succeed, the <strong>Stage</strong> in API Gateway must have defined a value for the <strong>envHotelSpecials</strong> stage variable.</p><ol start=79><li>Click <strong>Stages</strong></li></ol><ul><li>Click <strong>prod</strong></li><li>Click tab <strong>Stage Variables</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-076.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"><div class="notices info"><p>a single variable is defined - <strong>envHotelSpecials</strong> - which correlates to the stage variable name the GET method was expecting. The value of the variable is <strong>GetHotelSpecials</strong> which is the name of the Lambda function that the template created using the JAR file you built and uploaded during the package/deploy process.</p></div></li></ul><h4 id=test-the-hotelspecials-api>Test the HotelSpecials API</h4><ol start=80><li>Expand the <strong>prod</strong> root element in the Stages list to reveal the hierarchy.</li></ol><ul><li>Click <strong>Get</strong></li><li>Click <strong>Invoke URL</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-077.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ul><ol start=81><li>After a moment while the Lambda function is initialised, you should see the JSON result of querying the mySQL database from the Lambda function
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.3-create-api-with-api-gateway/create-api-with-api-gateway-078.png?featherlight=false&width=90pc" alt="Create And Expose the API with Amazon API Gateway"></li></ol><p>If you see a JSON payload with no errors, you have successfully deployed an API and supporting Lambda function that queries the mySQL database. Notice how much quicker and easier that was to deploy without any manual intervention? That is the power of automation. In the next exercise, we will take this one step further, using the (now familiar) CI/CD pipeline approach to deploy our next API.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/ title="Manually Build And Deploy A Serverless Microservice"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.4-deploy-api-with-codestar/ title="Deploy the api using code star and CI/CD" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://hotloncon1.github.io/aws-lab000055/js/clipboard.min.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/perfect-scrollbar.min.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/perfect-scrollbar.jquery.min.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/jquery.sticky.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/featherlight.min.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/highlight.pack.js?1659035587></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://hotloncon1.github.io/aws-lab000055/js/modernizr.custom-3.6.0.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/learn.js?1659035587></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/hugo-learn.js?1659035587></script>
<link href=https://hotloncon1.github.io/aws-lab000055/mermaid/mermaid.css?1659035587 rel=stylesheet><script src=https://hotloncon1.github.io/aws-lab000055/mermaid/mermaid.js?1659035587></script>
<script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>