<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=https://hotloncon1.github.io/aws-lab000055/images/favicon.png type=image/png><title>Xây dựng và triển khai Serverless Microservice thủ công :: Tạo một Single Page Application(SPA) được xác thực</title><link href=https://hotloncon1.github.io/aws-lab000055/css/nucleus.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/fontawesome-all.min.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/hybrid.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/featherlight.min.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/perfect-scrollbar.min.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/auto-complete.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/atom-one-dark-reasonable.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/theme.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/hugo-theme.css?1659042450 rel=stylesheet><link href=https://hotloncon1.github.io/aws-lab000055/css/theme-workshop.css?1659042450 rel=stylesheet><script src=https://hotloncon1.github.io/aws-lab000055/js/jquery-3.3.1.min.js?1659042450></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://hotloncon1.github.io/aws-lab000055/><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/lunr.min.js?1659042450></script>
<script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/auto-complete.js?1659042450></script>
<script type=text/javascript>var baseurl="https://hotloncon1.github.io/aws-lab000055//vi"</script><script type=text/javascript src=https://hotloncon1.github.io/aws-lab000055/js/search.js?1659042450></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-introduction/ title="Giới thiệu" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/1-introduction/><b>1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-prepare/ title="Chuẩn bị" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/2-prepare/><b>2. </b>Chuẩn bị
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/2-prepare/2.1-createkeypair/ title="Tạo Key Pair" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/2-prepare/2.1-createkeypair/><b>2.1. </b>Tạo Key Pair
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-prepare/2.2-createstack/ title="Tạo CloudFormation stack" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/2-prepare/2.2-createstack/><b>2.2. </b>Tạo CloudFormation stack
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/2-prepare/2.3-connectvirtualmachine/ title="Kết nối Windows instance" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/2-prepare/2.3-connectvirtualmachine/><b>2.3. </b>Kết nối Windows instance
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/3-create-single-page-app/ title="Tạo Single Page Application" class="dd-item
parent"><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/><b>3. </b>Tạo Single Page Application
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-create-single-page-app/3.1-create-dynamodb-table/ title="Tạo DynamoDB Table" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.1-create-dynamodb-table/><b>3.1. </b>Tạo DynamoDB Table
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/ title="Xây dựng và triển khai Serverless Microservice thủ công" class="dd-item
active"><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/><b>3.2. </b>Xây dựng và triển khai Serverless Microservice thủ công
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-create-single-page-app/3.3-create-api-with-api-gateway/ title="Tạo và Cung cấp API với Amazon API Gateway" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.3-create-api-with-api-gateway/><b>3.3. </b>Tạo và Cung cấp API với Amazon API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-create-single-page-app/3.4-deploy-api-with-codestar/ title="Triển khai API với Codestar và CI/CD" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.4-deploy-api-with-codestar/><b>3.4. </b>Triển khai API với Codestar và CI/CD
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-create-single-page-app/3.5-setup-single-page-app-website/ title="Thiết lập trang SPA " class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.5-setup-single-page-app-website/><b>3.5. </b>Thiết lập trang SPA
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-create-single-page-app/3.6-build-api-consumer/ title="Tạo một Client để sử dụng API" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.6-build-api-consumer/><b>3.6. </b>Tạo một Client để sử dụng API
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-configure-aaa/ title="Cấu hình Authentication, Authorization và Accounting (AAA)" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/4-configure-aaa/><b>4. </b>Cấu hình Authentication, Authorization và Accounting (AAA)
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-configure-aaa/4.1-add-authentication-with-cognito/ title="Thêm Xác thực vào SPA sử dụng Amazon Cognito User Pools" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/4-configure-aaa/4.1-add-authentication-with-cognito/><b>4.1. </b>Thêm Xác thực vào SPA sử dụng Amazon Cognito User Pools
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-configure-aaa/4.2-setup-authentication/ title="Thiết lập Xác thực cho Microservice" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/4-configure-aaa/4.2-setup-authentication/><b>4.2. </b>Thiết lập Xác thực cho Microservice
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-configure-aaa/4.3-deploy-and-test/ title="Triển khai và Kiểm thử" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/4-configure-aaa/4.3-deploy-and-test/><b>4.3. </b>Triển khai và Kiểm thử
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-configure-aaa/4.4-add-new-user-signup_signin/ title="Đăng ký người dùng mới và đăng nhập" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/4-configure-aaa/4.4-add-new-user-signup_signin/><b>4.4. </b>Đăng ký người dùng mới và đăng nhập
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-tracing-application-performance-with-xray/ title="Theo dõi Hiệu năng Ứng dụng với AWS X-Ray" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/5-tracing-application-performance-with-xray/><b>5. </b>Theo dõi Hiệu năng Ứng dụng với AWS X-Ray
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/6-challenge/ title="Bài tập nâng cao " class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/6-challenge/><b>6. </b>Bài tập nâng cao
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-cleanup/ title="Dọn dẹp tài nguyên" class=dd-item><a href=https://hotloncon1.github.io/aws-lab000055/vi/7-cleanup/><b>7. </b>Dọn dẹp tài nguyên
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/660548818043427/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/>English</option><option id=vi value=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7833031&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0></left>
<left><br><br><b>Last Updated</b><br><i><font color=orange>29-07-2022</font></i></left>
<left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a></i></left>
<script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://hotloncon1.github.io/aws-lab000055/vi/>Cơ cấu lại dữ liệu và quy trình làm việc của bạn</a> > <a href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/>Tạo Single Page Application</a> > Xây dựng và triển khai Serverless Microservice thủ công</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Xây dựng và triển khai Serverless Microservice thủ công</h1><h4 id=xây-dựng-và-triển-khai-serverless-microservice-thủ-công>Xây dựng và triển khai Serverless Microservice thủ công</h4><p><code>aws s3 cp target/tripsearch-1.0.0.jar s3:// --region us-east-1</code>
aws lambda create-function &ndash;function-name idevelopTripSearchFromCity &ndash;runtime java8 &ndash;role arn:aws:iam::649966601103:role/LambdaRole &ndash;handler devlounge.lambda.FindTripsFromCityHandler &ndash;code S3Bucket=devax-06-s3bucketlambdacode4dbb269b-ydaa2pngaf8t,S3Key=tripsearch-1.0.0.jar &ndash;timeout 15 &ndash;description &ldquo;TravelBuddy TripSearch microservice - FindTripsFromCity&rdquo; &ndash;memory-size 1024 &ndash;region us-east-1</p><p>aws lambda create-function &ndash;function-name idevelopFindTripsToCity &ndash;runtime java8 &ndash;role arn:aws:iam::649966601103:role/LambdaRole &ndash;handler devlounge.lambda.FindTripsToCityHandler &ndash;code S3Bucket=devax-06-s3bucketlambdacode4dbb269b-ydaa2pngaf8t,S3Key=tripsearch-1.0.0.jar &ndash;timeout 15 &ndash;description &ldquo;TravelBuddy TripSearch microservice - FindTripsToCity&rdquo; &ndash;memory-size 1024 &ndash;region us-east-1</p><pre tabindex=0><code>set AWS_PROFILE=devaxacademy
mvn package shade:shade
</code></pre><p>aws cloudformation package &ndash;template template.yml &ndash;s3-bucket devax-06-s3bucketlambdacode4dbb269b-ydaa2pngaf8t &ndash;output-template template-export.yml
aws cloudformation package &ndash;template template.yml &ndash;s3-bucket devax-06-s3bucketlambdacode4dbb269b-ydaa2pngaf8t &ndash;output-template template-export.yml</p><p>Trong bài tập này, bạn sẽ tự tạo và cấu hình một serverless microservice. Trong quá trình làm bài thực hành, bạn sẽ sử dụng các kỹ thuật khác nhau để xây dựng và triển khai, khi đó bạn có thể so sánh và đối chiếu hiệu quả của từng cách tiếp cận và phương pháp tự động hóa làm cho việc phát triển ứng dụng trở nên nhanh hơn và hiệu quả hơn cho các developer.</p><p>Bạn sẽ tạo thủ công TripSearch microservice. TripSearch microservice cung cấp các hàm sau:</p><ul><li><strong>/trips</strong> - trả về danh sách tất cả các chuyến đi có sẵn trong hệ thống.</li><li><strong>/tripsfromcity</strong> - trả về danh sách tất cả các chuyến đi xuất phát từ một thành phố nhất định.</li><li><strong>/tripstocity</strong> - trả về danh sách tất cả các chuyến đi có điểm đến là một thành phố nhất định</li></ul><p>Đây là cùng một microservice mà chúng ta đã xem xét trong bài thực hành trước đây. Nhưng lần này, chúng ta sẽ cung cấp chức năng này trong trang web TravelBuddy của chúng ta và do đó, cần triển khai dịch vụ để chuẩn bị cho trang web. Trước đây, việc cấu hình API Gateway được quản lý bởi pipeline triển khai cho bạn - trong bài tập này, bạn sẽ cấu hình thủ công thiết cho cả hàm Lambda và API Gateway.</p><h4 id=tải-mã-nguồn-và-xây-dựng-thành-phần-cho-triển-khai>Tải mã nguồn và xây dựng thành phần cho triển khai</h4><section class="attachments orange"><label><i class="fas fa-paperclip" aria-hidden=true></i>
TripSearchFull Project</label><div class=attachments-files><li><a href=https://hotloncon1.github.io/aws-lab000055/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/_index.vi.files/TripSearchFull.zip>TripSearchFull.zip</a>
(21 KB)</li><div></section><ol><li>Bạn hãy tải tập tin <strong>TripSearchFull.zip</strong> và giải nén</li><li>Mở <strong>Command Prompt</strong> và chuyển đường dẫn đến project <strong>TripSearchFull</strong> đã giải nén ở bước 1</li></ol><ul><li>Chạy lệnh dưới đây:</li></ul><pre tabindex=0><code>set AWS_PROFILE=devaxacademy
set DDB_TABLENAME_TRIPSECTOR=TravelBuddyTripSectors
mvn test
</code></pre><p><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-001.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice">
3. Bạn sẽ thấy kết quả:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-002.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice"><div class="notices note"><p>Nhớ rằng thành phố đi và đến thể hiện ở đây và thời gian, ngày tháng sẽ khác so với môi trường triển khai của bạn vì nó được tạo ngẫu nhiên.<br>Bạn sẽ thấy không có thông báo lỗi nào khi chạy unit test và điều đó chắc chắn rằng mã nguồn của bạn đã chạy được như dự kiến. Nếu vẫn thấy lỗi, hãy thử kiểm tra thêm.</p></div></p><h4 id=tại-sao-bạn-lại-thấy-thông-báo-aws-x-ray-unavailable---ignoring>Tại sao bạn lại thấy thông báo <strong>AWS X-ray unavailable - ignoring</strong>?</h4><p>Khi bạn chạy test trong môi trường Development local, AWS X-RAy agent không khả dụng, và vì như vậy việc gọi từ AWS SDK không được ghi nhận vào X-Ray. Tuy nhiên, thiết lập trong <strong>pom.xml</strong> xác định sử dụng AWS X-Ray recorder, tất cả các lệnh gọi tới thông qua SDK (VD: gọi tới DynamoDB) sẽ được ghi nhận. Việc này sẽ gây phát sinh lỗi và test sẽ fail.</p><p>Chú ý rằng mỗi một lớp Lambda handler đều extend từ một lớp nền tên là <strong>LambdaHandlerWithXRayBase</strong>. Trong lớp này, có một khởi tạo static và nó xây dựng đối tượng <strong>ContextMissingStrategy</strong>, ghi đè hành động khi không có AWS X-Ray và thiết lập đó là hành động mặc định. Trong quá trình triển khai <strong>contextMissing handler</strong>, chúng ta có xuất ra một nội dung ra console, thay vì hành động mặc định là đưa ra exception. Việc triển khai lớp <strong>LambdaHandlerWithXRayBase</strong> tương tự như sau:</p><pre tabindex=0><code>public class LambdaHandlerWithXRayBase 
{
	static  
	{
	  AWSXRayRecorderBuilder builder = AWSXRayRecorderBuilder.standard();

	  builder.withContextMissingStrategy(new ContextMissingStrategy() 
	  {		
		@Override
		public void contextMissing(String arg0, Class&lt;? extends RuntimeException&gt; arg1) 
		{ 
			System.out.println(&#34;AWS X-ray unavailable - ignoring&#34;); 
		}	  
	  });

	  AWSXRay.setGlobalRecorder(builder.build());
	}
}
</code></pre><p>Là một thử nghiệm tùy chọn, bạn có thể thử xóa trình khởi tạo static khỏi lớp cơ sở <strong>LambdaHandlerWithXRayBase</strong> và chạy lại <strong>Maven build</strong>. Bạn sẽ thấy các lỗi như:</p><pre tabindex=0><code>com.amazonaws.xray.exceptions.SegmentNotFoundException: Thread failed to begin a subsegment: segment not found. Verify that a segment is in progress, and that the SegmentContextResolverChain is configured correctly in order to discover the segment.
</code></pre><p>Nếu không có agent, và lệnh gọi hàm Lambda trong trường hợp Id tương quan được chuyển chính xác đến nó, <strong>SegmentContextResolverChain</strong> không thể xác định phân vùng AWS X-ray để đính kèm metadata đã ghi vào và đưa ra exception. Việc triển khai chúng ta cung cấp trong lớp cơ sở sẽ ghi đè hành vi này, nhằm bỏ qua điều kiện này một cách an toàn trong khi thử nghiệm trên môi trường phát triển của bạn.</p><ol start=4><li>Nếu quá trình chạy unit test thành công, chạy câu lệnh <code>mvn package shade:shade</code> để build
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-003.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice"></li><li>Sẽ mất một chút thời gian để build mã nguồn ứng dụng. Sau khi tập tin JAR đã được build sẽ nằm trong thư mục <strong>target</strong> của project và có tên là <strong>tripsearch-1.0.0.jar</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-004.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice"></li><li>Truy cập <a href=https://console.aws.amazon.com/cloudformation/home><strong>Amazon CloudFormation Console</strong></a>.</li></ol><ul><li>Click <strong>Stacks</strong></li><li>Nhập <code>DevAx-06</code> vào ô tìm kiếm và nhấn <strong>Enter</strong></li><li>Click <strong>DevAx-06</strong>
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-010.png?featherlight=false&width=90pc" alt="Manually Build And Deploy A Serverless Microservice"></li></ul><ol start=7><li>Click tab <strong>Outputs</strong></li></ol><ul><li>Lưu giá trị <strong>LambdaRoleARN</strong> và <strong>S3BucketLambdaCodeBucketName</strong> để dùng trong bước tiếp theo
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-011.png?featherlight=false&width=90pc" alt="Manually Build And Deploy A Serverless Microservice"></li></ul><ol start=8><li>Trong <strong>Command Prompt</strong>, chạy lệnh dưới đây</li></ol><pre tabindex=0><code>aws s3 cp target/tripsearch-1.0.0.jar s3://&lt;S3BucketLambdaCodeBucketName&gt; --region &lt;YOUR_REGION&gt;
</code></pre><p><div class="notices note"><p>Thay <strong>&lt;S3BucketLambdaCodeBucketName></strong> bằng giá trị <strong>S3BucketLambdaCodeBucketName</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;YOUR_REGION></strong> bằng <strong>Region</strong> của bạn</p></div><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-005.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice">
9. Chạy lệnh dưới đây để tạo một hàm Lambda mới từ cấu phần triển khai này</p><pre tabindex=0><code>aws lambda create-function --function-name idevelopTripSearchFull --runtime java8 --role &lt;LambdaRoleARN&gt; --handler devlounge.lambda.FindAllTripsHandler --code S3Bucket=&lt;S3BucketLambdaCodeBucketName&gt;,S3Key=tripsearch-1.0.0.jar --timeout 15 --description &#34;TravelBuddy TripSearch microservice - FindAllTrips&#34; --memory-size 1024 --region &lt;YOUR_REGION&gt;
</code></pre><p><div class="notices note"><p>Thay <strong>&lt;LambdaRoleARN></strong> bằng giá trị <strong>LambdaRoleARN</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;S3BucketLambdaCodeBucketName></strong> bằng giá trị <strong>S3BucketLambdaCodeBucketName</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;YOUR_REGION></strong> bằng <strong>Region</strong> của bạn</p></div><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-006.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice">
10. Nếu thành công, hàm Lambda mới của bạn sẽ được tạo và bạn sẽ thấy kết quả trả về tương tự như sau:
<img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-007.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice"></p><h4 id=tạo-hai-hàm-lambda-mới-sử-dụng-chung-các-thành-phần-triển-khai>Tạo hai hàm Lambda mới sử dụng chung các thành phần triển khai</h4><p>Mã triển khai chức năng TripSearch của chúng ta có ba handler được cung cấp - một để tìm tất cả các chuyến đi; một để tìm các chuyến đi bắt nguồn từ một thành phố nhất định; và một để tìm các chuyến đi có một thành phố nhất định làm điểm đến. Hiện tại, chúng ta mới chỉ tiếp xúc với một handler - tìm kiếm cho tất cả các chuyến đi. Trong phần này, chúng ta sẽ tạo hai hàm Lambda mới, mỗi hàm cung cấp một trong hai handler còn lại.</p><ol start=11><li>Tạo một hàm Lambda mới từ cùng một cấu phần triển khai mà chúng ta đã tải lên trước đó. Chúng ta có thể tạo các hàm Lambda khác nhau từ cùng một thành phần vì tạo tác xuất ra nhiều Lambda handler. Ở bước trên, chúng ta đã cung cấp <strong>devlounge.lambda.FindAllTripsHandler</strong>. Trong bước này, chúng ta sẽ cung cấp <strong>devlounge.lambda.FindTripsFromCityHandler</strong>. Chạy câu lệnh dưới đây:</li></ol><pre tabindex=0><code>aws lambda create-function --function-name idevelopTripSearchFromCity --runtime java8 --role &lt;LambdaRoleARN&gt; --handler devlounge.lambda.FindTripsFromCityHandler --code S3Bucket=&lt;S3BucketLambdaCodeBucketName&gt;,S3Key=tripsearch-1.0.0.jar --timeout 15 --description &#34;TravelBuddy TripSearch microservice - FindTripsFromCity&#34; --memory-size 1024 --region &lt;YOUR_REGION&gt;
</code></pre><p><div class="notices note"><p>Thay <strong>&lt;LambdaRoleARN></strong> bằng giá trị <strong>LambdaRoleARN</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;S3BucketLambdaCodeBucketName></strong> bằng giá trị <strong>S3BucketLambdaCodeBucketName</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;YOUR_REGION></strong> bằng <strong>Region</strong> của bạn</p></div><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-008.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice">
12. Tạo hàm Lambda cuối cùng với cùng thành phần triển khai, lần này là cho <strong>FindTripsToCity</strong>. Cũng như các bước trên, lần này chúng ta sẽ cung cấp <strong>devlounge.lambda.FindTripsToCityHandler</strong>.Chạy câu lệnh dưới đây:</p><pre tabindex=0><code>aws lambda create-function --function-name idevelopFindTripsToCity --runtime java8 --role &lt;LambdaRoleARN&gt; --handler devlounge.lambda.FindTripsToCityHandler --code S3Bucket=&lt;S3BucketLambdaCodeBucketName&gt;,S3Key=tripsearch-1.0.0.jar --timeout 15 --description &#34;TravelBuddy TripSearch microservice - FindTripsToCity&#34; --memory-size 1024 --region &lt;YOUR_REGION&gt;
</code></pre><p><div class="notices note"><p>Thay <strong>&lt;LambdaRoleARN></strong> bằng giá trị <strong>LambdaRoleARN</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;S3BucketLambdaCodeBucketName></strong> bằng giá trị <strong>S3BucketLambdaCodeBucketName</strong> chúng ta đã lưu trong bước 7<br>Thay <strong>&lt;YOUR_REGION></strong> bằng <strong>Region</strong> của bạn</p></div><img src="https://hotloncon1.github.io/aws-lab000055/images/3-create-single-page-app/3.2-build-and-deploy-serverless-microservice/build-and-deploy-serverless-microservice-009.png?featherlight=false&width=60pc" alt="Manually Build And Deploy A Serverless Microservice"><div class="notices note"><p>Chắc chắn rằng bạn sẽ được nhận các phản hồi thành công tương tự với hàm Lambda đã tạo đầu tiên.</p></div></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.1-create-dynamodb-table/ title="Tạo DynamoDB Table"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://hotloncon1.github.io/aws-lab000055/vi/3-create-single-page-app/3.3-create-api-with-api-gateway/ title="Tạo và Cung cấp API với Amazon API Gateway" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://hotloncon1.github.io/aws-lab000055/js/clipboard.min.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/perfect-scrollbar.min.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/perfect-scrollbar.jquery.min.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/jquery.sticky.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/featherlight.min.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/highlight.pack.js?1659042450></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://hotloncon1.github.io/aws-lab000055/js/modernizr.custom-3.6.0.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/learn.js?1659042450></script>
<script src=https://hotloncon1.github.io/aws-lab000055/js/hugo-learn.js?1659042450></script>
<link href=https://hotloncon1.github.io/aws-lab000055/mermaid/mermaid.css?1659042450 rel=stylesheet><script src=https://hotloncon1.github.io/aws-lab000055/mermaid/mermaid.js?1659042450></script>
<script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>